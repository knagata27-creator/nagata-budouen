/* =========================================================
   Nagata Budou-en – Site Styles (revamped)
   - Fixed header + fixed status bar layout
   - Mobile nav toggle (.open) + active link
   - Smooth scroll with proper anchor offset
   - Card grid, reveal animation, a11y focus
   - aspect-ratio fallback for older browsers
   ========================================================= */

/* ---------------- Base Tokens ---------------- */
:root{
  --bg:#fafaf8;
  --ink:#243226;
  --ink-sub:#4a5a4a;
  --brand:#5b7a59;
  --brand-2:#4d6b4b;
  --brand-dark:#415a40;
  --accent:#7aa36f;
  --accent-2:#86b07c;
  --line:#e7e7e2;

  --radius:16px;
  --radius-sm:12px;

  --shadow:0 6px 20px rgba(20,30,20,.08);
  --shadow-lg:0 10px 30px rgba(20,30,20,.12);
  --shadow-soft:0 10px 32px rgba(20,30,20,.08);

  --header-h:72px;   /* header fixed height */
  --status-h:42px;   /* status bar fixed height */
  --content-w:1100px;
}

@media (max-width: 900px){
  :root{ --header-h:64px; }
}

/* ---------------- Reset / Base ---------------- */
*,
*::before,
*::after{ box-sizing:border-box; }

html{
  scroll-behavior:smooth;
  /* Anchor offset for :target jumps */
  scroll-padding-top: calc(var(--header-h) + var(--status-h) + 12px);
}

body{
  margin:0;
  color:var(--ink);
  background:var(--bg);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
  line-height:1.7;
  letter-spacing:.01em;
  /* Prevent content from hiding under fixed header + status */
  padding-top: calc(var(--header-h) + var(--status-h));
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
}

img{ max-width:100%; display:block; height:auto; }
a{ color:inherit; text-underline-offset: 2px; }
a:focus-visible{ outline:2px solid #1a73e8; outline-offset:2px; border-radius:6px; }

/* Visually hidden utility (for a11y) */
.visually-hidden{
  position:absolute!important; height:1px; width:1px; overflow:hidden;
  clip:rect(1px,1px,1px,1px); white-space:nowrap; clip-path:inset(50%); border:0; padding:0; margin:-1px;
}

/* ---------------- Header ---------------- */
.site-header{
  position:fixed; inset:0 0 auto 0; height:var(--header-h); z-index:1000;
}
.site-header .bar{
  height:100%; display:flex; align-items:center; justify-content:center;
  background: linear-gradient(180deg, var(--brand), var(--brand-2));
  color:#fff; box-shadow:0 2px 8px rgba(0,0,0,.08);
  transition: background .3s ease, backdrop-filter .3s ease, box-shadow .3s ease;
}
.site-header.is-scrolled .bar{
  background: linear-gradient(180deg, rgba(91,122,89,.92), rgba(77,107,75,.92));
  backdrop-filter: blur(8px);
  box-shadow:0 8px 28px rgba(0,0,0,.12);
}

.inner{
  width:100%; max-width:var(--content-w);
  margin:0 auto; padding:0 20px;
  display:flex; align-items:center; gap:16px;
}

.brand{ display:flex; align-items:center; gap:12px; margin:0; }
.brand__logo{ width:28px; height:28px; display:inline-block; }
.brand__name{ font-size:1.06rem; font-weight:800; letter-spacing:.04em; white-space:nowrap; }

/* Primary nav */
nav.primary{
  margin-left:auto; display:flex; align-items:center; gap:6px;
  flex-wrap:nowrap; overflow-x:auto; -webkit-overflow-scrolling:touch;
}
nav.primary a{
  color:#fff; text-decoration:none; font-weight:700; padding:10px 12px;
  border-radius:12px; white-space:nowrap; font-size:0.95rem;
  transition: background .18s ease, transform .18s ease;
}
nav.primary a:hover,
nav.primary a:focus-visible{
  background:rgba(255,255,255,.16); transform:translateY(-1px);
}
nav.primary a.is-active{
  background: rgba(255,255,255,.22);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.25);
}

/* Hamburger */
.nav-toggle{
  display:none; margin-left:auto; background:transparent; border:none; color:#fff;
  padding:10px; border-radius:12px; cursor:pointer;
}
.nav-toggle:focus-visible{ outline:2px solid #fff; }
.nav-toggle__bar{ display:inline-block; width:26px; height:2px; background:#fff; position:relative; }
.nav-toggle__bar::before,
.nav-toggle__bar::after{
  content:""; position:absolute; left:0; width:26px; height:2px; background:#fff;
  transition:transform .25s ease, top .25s ease, opacity .2s;
}
.nav-toggle__bar::before{ top:-7px; }
.nav-toggle__bar::after { top: 7px; }
.is-open .nav-toggle__bar{ background:transparent; }
.is-open .nav-toggle__bar::before{ top:0; transform:rotate(45deg); }
.is-open .nav-toggle__bar::after{ top:0; transform:rotate(-45deg); }

/* ---------------- Fixed Status Bar ---------------- */
.status{
  position:fixed; top:var(--header-h); left:0; right:0; height:var(--status-h);
  z-index:999; display:flex; align-items:center; color:#213320;
  background: linear-gradient(90deg, #f2f7ef, #ecf5ea);
  border-bottom:1px solid #e5efe2; font-weight:700; letter-spacing:.01em;
}
.status .inner{ display:flex; gap:12px; align-items:center; }
.status .pill{
  display:inline-flex; align-items:center; gap:6px;
  padding:6px 10px; border-radius:999px; background:#fff;
  border:1px solid #e5efe2; font-weight:800;
}
.status .sep{ opacity:.5; }
.status a{ text-decoration:none; font-weight:800; color:#265f2a; }
.status a:hover{ text-decoration:underline; }

/* ---------------- Sections & Layout ---------------- */
.section{ scroll-margin-top: calc(var(--header-h) + var(--status-h) + 12px); }
.container{ max-width:var(--content-w); margin:0 auto; padding:64px 20px; }

.section-title{
  font-size:clamp(22px, 3.8vw, 30px);
  margin:0 0 16px; letter-spacing:.02em;
}
.section-title.deco{
  position:relative; padding-bottom:10px;
}
.section-title.deco::after{
  content:""; position:absolute; left:0; bottom:0; width:64px; height:4px;
  border-radius:4px; background:linear-gradient(90deg, var(--accent), var(--accent-2));
}
.section-lead{ color:var(--ink-sub); margin:0 0 26px; font-size:1.02rem; }
.note{ margin-top:10px; color:#5a6a5a; }

.btn{
  display:inline-block; padding:12px 18px; border-radius:999px;
  background:#fff; color:var(--brand-dark); text-decoration:none;
  font-weight:800; border:1px solid rgba(0,0,0,.06);
  box-shadow:0 1px 0 rgba(0,0,0,.05);
  transition:transform .15s ease, filter .15s ease, box-shadow .15s ease;
}
.btn:hover{ filter:brightness(0.98); transform:translateY(-1px); }
.btn:active{ transform:translateY(0); }
.btn[aria-disabled="true"]{ opacity:.6; pointer-events:none; }

.btn--fill{
  background:linear-gradient(180deg, var(--accent), var(--accent-2));
  color:#fff; border:none;
}
.btn-row{ display:flex; gap:12px; flex-wrap:wrap; }

/* ---------------- Hero ---------------- */
.hero{
  position:relative; min-height:66vh; display:grid; place-items:center; color:#fff;
}
.hero::before{
  content:""; position:absolute; inset:0;
  background:
    linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.35)),
    url('../img/hero.svg') center/cover no-repeat;
  filter:saturate(1.05);
}
.hero__content{ position:relative; width:100%; }
.hero .container{ padding:96px 20px; }
.kicker{
  display:inline-block; background:rgba(255,255,255,.22);
  padding:6px 10px; border-radius:999px; font-weight:800; letter-spacing:.06em;
}
.hero h1{ font-size:clamp(28px, 5vw, 46px); line-height:1.25; margin:12px 0 12px; }
.hero p{ max-width:820px; margin:0 0 22px; font-size:1.06rem; }
.cta{ display:flex; gap:12px; flex-wrap:wrap; }

/* ---------------- Cards & Grids ---------------- */
.grid{ display:grid; gap:18px; }
.grid-2{ grid-template-columns:repeat(2, 1fr); }
.grid-3{ grid-template-columns:repeat(3, 1fr); }

.two-col{
  display:grid; grid-template-columns:1.2fr 1fr; gap:28px; align-items:center;
}

.card{
  background:#fff; border:1px solid var(--line); border-radius:var(--radius);
  padding:22px; box-shadow:var(--shadow);
}

.lift{ transition:transform .2s ease, box-shadow .2s ease; }
.lift:hover{ transform:translateY(-2px); box-shadow:var(--shadow-lg); }

.variety__img{ height:180px; border-radius:12px; overflow:hidden; }
.variety__img img{ width:100%; height:100%; object-fit:cover; }

.meta{ color:#6a6a64; font-size:.9rem; }
.price{ font-weight:900; font-size:1.1rem; }
.badge{
  display:inline-block; padding:.25rem .5rem; background:#eef6ed;
  border:1px solid #e5efe2; border-radius:8px; font-weight:700; font-size:.8rem;
}

/* Product card footer row */
.product-card .footer{
  display:flex; justify-content:space-between; align-items:center; margin-top:10px;
}

/* ---------------- Calendar ---------------- */
.calendar-embed{
  aspect-ratio:16 / 9; width:100%; border:0; border-radius:12px;
  background:#fff; box-shadow:var(--shadow-soft);
}
/* Fallback for browsers without aspect-ratio */
@supports not (aspect-ratio: 1 / 1){
  .calendar-embed{ height:56.25vw; max-height:600px; }
}

/* ---------------- Blog/News ---------------- */
.post{ display:flex; gap:14px; align-items:stretch; }
.post img{ width:140px; height:100px; object-fit:cover; border-radius:10px; }
.post h4{ margin:4px 0 6px; font-size:1rem; }
.post time{ color:#75756d; font-size:.9rem; }

/* ---------------- Footer ---------------- */
footer{
  background:linear-gradient(180deg, var(--brand-2), var(--brand-dark));
  color:#eaf1e9; margin-top:40px;
}
.footer-inner{ display:grid; grid-template-columns:1.3fr 1fr; gap:22px; }
.footer-inner a{ color:#eaf1e9; opacity:.9; text-decoration:none; }
.footer-inner a:hover{ opacity:1; text-decoration:underline; }
.footer-title{ margin:0 0 8px; }
.copyright{
  border-top:1px solid rgba(255,255,255,.15);
  margin-top:12px; padding-top:12px; font-size:.9rem; color:#dfe6dd;
}

/* ---------------- Utilities ---------------- */
.ratio-3x2{ position:relative; padding-top:66.66%; }
.ratio-3x2 > *{ position:absolute; inset:0; }

.radius-16{ border-radius:16px; }
.shadow-soft{ box-shadow:var(--shadow-soft); }
.overflow-hidden{ overflow:hidden; }

/* keyboard skip link */
.skip-link{
  position:absolute; left:-999px; top:auto; width:1px; height:1px; overflow:hidden;
}
.skip-link:focus{
  position:fixed; left:10px; top:10px; width:auto; height:auto;
  background:#fff; color:#000; padding:10px 12px; border-radius:8px; z-index:1001;
  box-shadow:0 6px 24px rgba(0,0,0,.16);
}

/* ---------------- Reveal Animation ---------------- */

.reveal{ opacity:1; transform:none; transition:opacity .5s ease, transform .5s ease; }

/* JSが動作し IntersectionObserver が有効な環境だけ、初期状態を非表示にする */
.js.has-io .reveal{ opacity:0; transform:translateY(12px); }
.js.has-io .reveal.in{ opacity:1; transform:none; }

@media (prefers-reduced-motion: reduce){
  .reveal{ transition:none; }    /* 動きを最小化 */
}

/* ---------------- Responsive ---------------- */
@media (max-width: 960px){
  .two-col{ grid-template-columns:1fr; }
}

@media (max-width: 900px){
  /* Mobile nav panel */
  .nav-toggle{ display:inline-flex; }
  nav.primary{
    position:fixed; top:var(--header-h); left:0; right:0;
    display:none; flex-direction:column; gap:4px;
    background:linear-gradient(180deg, rgba(91,122,89,.98), rgba(77,107,75,.98));
    padding:10px 12px 16px; border-bottom:1px solid rgba(255,255,255,.15);
    z-index:1002; /* above status bar */
  }
  nav.primary.open{ display:flex; }
  nav.primary a{ display:block; width:100%; padding:12px 10px; border-radius:10px; }

  /* Grids */
  .grid-3{ grid-template-columns:1fr 1fr; }
  .post{ flex-direction:column; }
  .post img{ width:100%; height:160px; }
}

@media (max-width: 640px){
  .grid-3{ grid-template-columns:1fr; }
}

/* ---------------- Print (basic) ---------------- */
@media print{
  .site-header, .status, .nav-toggle, nav.primary, .hero::before{ display:none !important; }
  body{ padding-top:0; background:#fff; }
  .card{ box-shadow:none; border-color:#ddd; }
}

/* 画面下にぴったり固定 */
.cart-sticky{
  position: fixed;       /* ← これがキモ */
  left: 0;
  right: 0;
  bottom: 0;             /* iPhone のホームバー分の余白も考慮 */
  padding-bottom: calc(14px + env(safe-area-inset-bottom, 0));
  z-index: 10010;        /* フッターより前面に */
  transform: translateZ(0);  /* iOSのガタつき防止 */
}

/* 固定バーに隠れないよう下に余白を付ける（約100px） */
body.has-sticky-cart{
  padding-bottom: 110px;
}

<!-- ▼ 追記：Shopをトップと同じ色合いにするテーマ上書き -->
<style id="shop-theme">
  /* トップページ側にブランド変数があれば流用、なければ #5b7a59 */
  :root{
    --brand: var(--color-brand, #5b7a59);
    --brand-ink: var(--color-on-brand, #ffffff);
    --brand-hover: color-mix(in srgb, var(--brand) 85%, black);
    --ink: var(--color-ink, #222);
    --surface: var(--color-surface, #fff);
    --border: var(--color-border, #e8e8e8);
  }

  /* カードと文字色のトーンをトップの雰囲気へ寄せる */
  #shopApp .card{
    background: var(--surface);
    border-color: var(--border);
  }
  #shopApp .name{ color: var(--ink); }
  #shopApp .meta{ color: color-mix(in srgb, var(--ink) 70%, white); }

  /* ボタンをブランド色に */
  #shopApp .btn{
    background: var(--brand);
    color: var(--brand-ink);
  }
  #shopApp .btn:hover:enabled{ background: var(--brand-hover); }

  /* 下固定カートバーをブランド色ベースに */
  #shopApp .cart-sticky{
    background: var(--brand);
    color: var(--brand-ink);
  }
  #shopApp .cart-sticky:hover{ background: var(--brand-hover); }

  /* 固定バー右の大きいCTAは反転で視認性UP */
  #shopApp .cart-sticky__cta{
    background: var(--brand-ink);
    color: var(--brand);
    box-shadow: 0 3px 10px rgba(0, 0, 0, .15);
  }
  #shopApp .cart-sticky:hover .cart-sticky__cta{
    background: color-mix(in srgb, var(--brand-ink) 92%, black);
  }

  /* カルーセルのドットを少し強めに（ブランド寄りの白） */
  #shopApp .carousel-dot{
    background: color-mix(in srgb, var(--brand-ink) 70%, transparent);
  }
  #shopApp .carousel-dot.is-active{
    background: var(--brand-ink);
  }

  /* タグのチップはデフォはブランド色、特種タグは従来の色を維持 */
  #shopApp .badge-chip{ background: var(--brand); }
  #shopApp .badge-chip.is-new{ background: #13b981; } /* 新 */
  #shopApp .badge-chip.is-hit{ background: #ef4444; } /* 人気 */
  #shopApp .badge-chip.is-season{ background: #3b82f6; } /* 今季 */

  /* フォーカスアウトラインもブランド寄りに */
  #shopApp .pressable:focus-visible{
    outline: 3px solid color-mix(in srgb, var(--brand) 50%, white);
    outline-offset: 2px;
  }

  /* スケルトンや境界線の色味を全体に合わせる（薄め） */
  #shopApp .skel-card{ border-color: var(--border); }
</style>
